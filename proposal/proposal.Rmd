---
title: "Project proposal"
author: "Rat Bastards"
output: github_document
---

```{r load-packages, message = FALSE}
library(tidyverse)
library(broom)
```

## 1. Introduction

Our data are a collection of phenological observations on vegetation from Hurricane Island. These data were gathered in the 2023 spring-fall field season to track the phenophases of a broad range of plant species. The data were collected by one of our team members who visited individual plants each week throughout the season. Photos were taken of each plant on a weekly basis to identify phenophase development. The phenophases tracked were based on the categories described by the National Phenology Network. The primary goal of this research is to create and visualize a baseline phenological record of the vegetation on Hurricane Island which can be used in future analysis. Additionally, we plan to analyze how the phenophases develop in response to varying climatic factors throughout the season. We also intend to visualize comparisons between differing species categories such as fruit-bearing/non-fruit-bearing, native/introduced, etc to see how their development varies. The cases are each plant species and its disposition on the calendar day on which it was observed. The variables are date of data collection, species information, and phenological observations made. Individual species have differing phenological observations made depending on varying morphology. (Eg. A plant that fruits versus one that does not).


## 2. Data

```{r hurricane-phenology-data, warning=FALSE}
library(readr)

hurricane_raw_data <- read_csv("../data/hurricane_plants.csv")

# reorder variables to logical order

hurricane_plants <- relocate(hurricane_raw_data, 
       date, 
       life_form, 
       species, 
       initial_emergence,
       breaking_leaf_buds_count,
       leaf_presence,
       percent_unfolded_leaves,
       unfolded_leaves_count,
       percent_full_size_leaf,
       percent_leaves_colorful,
       fallen_leaf_presence,
       breaking_needle_bud_count,
       young_needle_count,
       percent_stalk_growth,
       percent_fiddlehead_unrolled,
       buds_and_flowers_count,
       percent_open_flowers,
       pollen_amount,
       pollen_cone_count,
       percent_open_pollen_cones,
       fruit_count,
       unripe_seed_cone_count, 
       percent_ripe_fruits,
       ripe_seed_cone_count,
       dropped_fruit_count,
       notes
       )

# Remove empty rows, where life_form is NA 
hurricane_plants <- hurricane_plants %>% 
  filter(!is.na(life_form))
# drop_na(life_form) - another option for the same function

# Write dataframe to CSV file
# write_csv(hurricane_plants, file = "hurricane_plants_reordered.csv")

glimpse(hurricane_plants)
```



```{r raster-package}
#install.packages("raster")
library(raster)
library(tidyverse)
# Note we may need to change to the geodata package
```


```{r worldclim-data}
#worldclim_data <- getData(name = "worldclim", var = "tmax", res = 10)
#gain(worldclim_data) <- 0.1

# Converting the raster object into a dataframe
#worldclim_data_df <- as.data.frame(worldclim_data, xy = TRUE, na.rm = TRUE)

#worldclim_data_df %>%

  #mutate(lat_dist = y-44.034109, lon_dist = x + 68.889076)

#  mutate(lat_dist = y-44.034109, lon_dist = x + 68.889076)

```

## 3. Ethics review
Data was collected by hand by one of our group members in an noninvasive way.

## 4. Data analysis plan

We will visualize date, breaking leaves/buds/needles, flowering, and fruiting phenophases of comparable species. We will also visualize these phenophases based on records of climatic variables from this field season. The climatic variables will need to be sourced from the Worldclim database. We plan on utilizing violin plots, lollipop plots, ridge plots, as well as potential animations and maps.
```{r summary-stats-distinct}
distinct(hurricane_plants, species) #there are 24 individual species
```

```{r summary-stats-max-min-breaking-leaf-and-needle}
hurricane_plants %>%
  group_by(species) %>%
  summarise(max_breaking_leaf = max(breaking_leaf_buds_count),
            max_breaking_needle = max(breaking_needle_bud_count)) #not returning breaking needle count for the red spruce. Something wrong with dataset?
```

```{r summary-stats-initial-emergence}
hurricane_plants %>%
  group_by(life_form) %>%
  filter(initial_emergence == "present") %>%
  summarise(initial_emergence_date_min = min(date),
            initial_emergence_date_max = max(date))

hurricane_plants %>%
  filter(life_form == "tree",
         breaking_leaf_buds_count > 0) %>%
  summarise(tree_initial_emergence_date_min = min(date),
            tree_initial_emergence_date_max = max(date))
#breaking leaf buds is the equivalent to initial emergence for trees. Figure out how to combine them into the same table?
#Look into why initial emergence max is all the same date so late in the season/if we even need initial emergence max
```
```{r summary-stats-flowers-and-buds}
hurricane_plants %>%
  group_by(species) %>%
  filter(!is.na(buds_and_flowers_count)) %>%  #remove NA values
  summarise(max_flowers_and_buds = max(buds_and_flowers_count)) #there are 24 spp, why is the code only returning 23 observations?

hurricane_plants %>%
  group_by(life_form) %>%
  filter(!is.na(buds_and_flowers_count)) %>%
  summarise(average_flowers_and_buds = mean(buds_and_flowers_count)) 
```

```{r flowers_and_buds}
# graph the amount of buds or flowers of each plant? facet by life form?
ggplot(hurricane_plants, mapping = 
         aes(x = date, y = buds_and_flowers_count, color = species)) +
  geom_density() +
  facet_wrap(~ life_form)
```


```{r leaves_unfolding}
# graph the percent leaves unfolded 
ggplot(hurricane_plants, mapping = 
         aes(x = date, y = buds_and_flowers_count, color = species)) +
  geom_density() +
  facet_wrap(~ life_form)
```

